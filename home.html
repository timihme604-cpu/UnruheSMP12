<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>UnruheSMP12</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Extra Styles f√ºr HOME */
        .menu {
            margin-top: 50px;
        }

        .menu button {
            display: block;
            margin: 15px auto;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            background-color: #3c8eeb;
            color: white;
            width: 250px;
            transition: 0.2s;
        }

        .menu button:hover {
            background-color: #337cd2;
            transform: scale(1.03);
        }

        h2 span {
            color: #4CAF50;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>UnruheSMP12</h1>
        <h2>Willkommen zur√ºck, <span id="playerDisplay"></span>!</h2>

        <div class="menu">
            <button onclick="location.href='events.html'">üó≥Ô∏è Event-Abstimmungen</button>
            <button id="whitelistBtn" style="display:none">üîí Whitelist verwalten</button>
            <button onclick="location.href='map.html'">üó∫Ô∏è Weltkarte</button>
            <button onclick="location.href='news.html'">üì∞ News & Infos</button>
        </div>
    </div>

    <script>
        // gespeicherten Spielernamen abrufen
        const name = localStorage.getItem("playername");

        if (!name) {
            // Falls jemand direkt hierher kommt ‚Üí zur√ºck zur Startseite
            window.location.href = "index.html";
        } else {
            document.getElementById("playerDisplay").textContent = name;
        }
        // Admin-only: Anfragen verwalten (nur ein Button)
        const adminName = 'UnruheSMP12';
        // Admin password stored for this page session
        let adminPass = null;
        if (name === adminName) {
            // Zus√§tzlicher Button: Anfragen verwalten
            const reqBtn = document.createElement('button');
            reqBtn.textContent = 'üì® Anfragen verwalten';
            reqBtn.style.display = 'inline-block';
            reqBtn.style.marginLeft = '8px';
            const menu = document.querySelector('.menu');
            if (menu) menu.appendChild(reqBtn);
            reqBtn.addEventListener('click', async () => {
                // Prompt for admin password once, save to sessionStorage and navigate to admin page
                let pass = sessionStorage.getItem('adminPass');
                if (!pass) {
                    pass = prompt('Admin-Passwort eingeben:');
                    if (!pass) return;
                    sessionStorage.setItem('adminPass', pass);
                }
                window.location.href = 'admin.html';
            });
        }

        // whitelist modal removed to keep single admin UI (requests management)

        async function showRequestsModal(adminPass) {
            // Modal wie oben
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.inset = '0';
            overlay.style.background = 'rgba(0,0,0,0.6)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.zIndex = '9999';

            const box = document.createElement('div');
            box.style.background = '#0f1720';
            box.style.padding = '18px';
            box.style.borderRadius = '10px';
            box.style.width = '420px';
            box.style.color = 'white';
            box.innerHTML = '<h3 style="margin:0 0 8px 0">Ausstehende Whitelist-Anfragen</h3>';

            const list = document.createElement('div');
            list.style.maxHeight = '300px';
            list.style.overflow = 'auto';
            list.style.marginTop = '8px';

            box.appendChild(list);

            const cancel = document.createElement('button');
            cancel.textContent = 'Schlie√üen';
            cancel.style.marginTop = '12px';
            cancel.style.padding = '8px 10px';
            cancel.style.borderRadius = '6px';
            cancel.style.cursor = 'pointer';
            cancel.addEventListener('click', () => overlay.remove());
            box.appendChild(cancel);

            overlay.appendChild(box);
            document.body.appendChild(overlay);

            // Lade Anfragen
            try {
                const res = await fetch('/whitelist/requests', { headers: { 'x-admin-pass': adminPass } });
                let arr = [];
                try { arr = await res.json(); } catch(e) { arr = [] }
                if (!res.ok) throw new Error('Fehler beim Laden');

                if (!arr.length) {
                    list.textContent = 'Keine offenen Anfragen.';
                    return;
                }

                arr.forEach(u => {
                    const row = document.createElement('div');
                    row.style.display = 'flex';
                    row.style.justifyContent = 'space-between';
                    row.style.alignItems = 'center';
                    row.style.padding = '8px';
                    row.style.borderBottom = '1px solid rgba(255,255,255,0.04)';

                    const name = document.createElement('div');
                    name.textContent = u;

                    const actions = document.createElement('div');
                    actions.style.display = 'flex';
                    actions.style.gap = '8px';

                    const approve = document.createElement('button');
                    approve.textContent = '‚úÖ Freischalten';
                    approve.style.background = '#4CAF50';
                    approve.style.border = 'none';
                    approve.style.padding = '6px 8px';
                    approve.style.borderRadius = '6px';
                    approve.style.cursor = 'pointer';
                    approve.addEventListener('click', async () => {
                        try {
                            const r = await fetch('/whitelist/approve', { method: 'POST', headers: {'Content-Type':'application/json','x-admin-pass': adminPass}, body: JSON.stringify({ user: u }) });
                            const j = await r.json();
                            if (!r.ok) throw new Error(j.error || r.statusText || 'Fehler');
                            row.remove();
                            alert(u + ' wurde zur Whitelist hinzugef√ºgt');
                        } catch (err) { alert('Fehler: ' + (err.message || err)); }
                    });

                    const reject = document.createElement('button');
                    reject.textContent = '‚ùå Ablehnen';
                    reject.style.background = 'transparent';
                    reject.style.border = '1px solid rgba(255,255,255,0.06)';
                    reject.style.padding = '6px 8px';
                    reject.style.borderRadius = '6px';
                    reject.style.cursor = 'pointer';
                    reject.addEventListener('click', async () => {
                        try {
                            const r = await fetch('/whitelist/reject', { method: 'POST', headers: {'Content-Type':'application/json','x-admin-pass': adminPass}, body: JSON.stringify({ user: u }) });
                            const j = await r.json();
                            if (!r.ok) throw new Error(j.error || r.statusText || 'Fehler');
                            row.remove();
                        } catch (err) { alert('Fehler: ' + (err.message || err)); }
                    });

                    actions.appendChild(approve);
                    actions.appendChild(reject);
                    row.appendChild(name);
                    row.appendChild(actions);
                    list.appendChild(row);
                });

            } catch (err) {
                list.textContent = 'Fehler beim Laden der Anfragen.';
            }
        }
    </script>

</body>
</html>
